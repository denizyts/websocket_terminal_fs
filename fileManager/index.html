<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Dual File Explorer</title>
  <style>
    body {
      display: flex;
      gap: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      margin: 0;
      padding: 20px;
      height: 100vh;
      box-sizing: border-box;
      color: #e0e0e0;
    }
    .panel {
      flex: 1;
      background: #1e1e1e;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s; 
    }
    .panel:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.6); }
    h3 { margin-top: 0; border-bottom: 2px solid #37474f; padding-bottom: 12px; font-weight: 700; color: #80cbc4; font-size: 1.3rem; }
    .search-input {
      padding: 8px 12px; border-radius: 8px; border: 1px solid #37474f; margin-bottom: 10px;
      font-size: 0.95rem; outline: none; background: #2c2c2c; color: #e0e0e0;
    }
    .search-input:focus { border-color: #80cbc4; }
    .file-input-wrapper { position: relative; margin-bottom: 15px; }
    .file-input-wrapper input[type="file"] { opacity: 0; width: 100%; height: 40px; position: absolute; cursor: pointer; }
    .file-input-label {
      display: block; background: #4800ff; color: white; text-align: center; padding: 10px;
      border-radius: 8px; cursor: pointer; font-weight: 500; transition: background 0.2s;
    }
    .file-input-label:hover { background: #00796b; }
    ul { list-style: none; padding: 0; margin: 0; flex: 1; overflow-y: auto; border-top: 1px solid #37474f; margin-top: 10px; }
    li {
      cursor: pointer; padding: 10px 14px; border-radius: 8px; transition: background 0.2s, color 0.2s;
      display: flex; align-items: center; justify-content: space-between; color: #e0e0e0;
      margin-bottom: 4px; background: #2c2c2c;
    }
    li:hover { background: #37474f; }
    li.directory { font-weight: 600; color: #a2ff01f0; }
    li span { margin-left: 8px; font-size: 0.9rem; }
    li.selected { background: #00695c !important; color: #ffffff; }
    ul::-webkit-scrollbar { width: 8px; }
    ul::-webkit-scrollbar-track { background: #1e1e1e; border-radius: 4px; }
    ul::-webkit-scrollbar-thumb { background-color: #616161; border-radius: 4px; }
    button {
      padding: 8px 14px; border: none; border-radius: 8px; background: #ff0088;
      color: white; font-weight: 500; cursor: pointer; transition: background 0.2s, transform 0.1s;
    }
    button:hover { background: #00796b; transform: translateY(-2px); }
    li button { padding: 4px 8px; font-size: 0.8rem; background: #00ffe1; }
    li button:hover { background: #009688; }
    .actions { display: flex; gap: 10px; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="panel">
    <h3>Local Files</h3>
    <div class="file-input-wrapper">
      <label class="file-input-label" for="localPicker">Choose File</label>
      <input type="file" id="localPicker" webkitdirectory directory multiple>
    </div>
    <ul id="localFiles"></ul>
    <button id="uploadAllBtn" style="margin-top:10px;">Upload all</button>
  </div>

  <div class="panel">
    <h3>Remote Files</h3>
    <input type="text" id="remoteSearch" class="search-input" placeholder="Search files">
    <div class="actions">
      <button id="downloadSelectedBtn">SeÃ§ileni Ä°ndir</button>
      <button id="deleteSelectedBtn">SeÃ§ileni Sil</button>
    </div>
    <ul id="remoteFiles"></ul>
  </div>

  <script>
    const ws = new WebSocket("ws://localhost:8080");
    const remoteList = document.getElementById("remoteFiles");
    const localList = document.getElementById("localFiles");
    const remoteSearch = document.getElementById("remoteSearch");
    let uploadPath = ".";
    let remoteFilesCache = [];
    let selectedFiles = new Set();

    ws.onopen = () => ws.send(JSON.stringify({ type: "list", path: "." }));

    ws.onmessage = e => {
      const data = JSON.parse(e.data);
      if (data.type === "list") {
        remoteFilesCache = data.files;
        renderRemote(remoteFilesCache, data.path);
      }
      if (data.type === "download") {
        const blob = new Blob([Uint8Array.from(atob(data.content), c => c.charCodeAt(0))]);
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = data.filename;
        a.click();
      }
    };

    function renderRemote(files, path) {
      uploadPath = path;
      remoteList.innerHTML = "";

      files.forEach(f => {
        const li = document.createElement("li");
        li.dataset.path = path + "/" + f.name;

        const nameSpan = document.createElement("span");
        nameSpan.textContent = f.name;
        if (f.isDir) li.classList.add("directory");

        // ðŸ‘‡ SEÃ‡ butonu
        const selectBtn = document.createElement("button");
        selectBtn.textContent = "SeÃ§";
        selectBtn.onclick = (e) => {
          e.stopPropagation(); // iÃ§ine girmesin
          if (li.classList.contains("selected")) {
            li.classList.remove("selected");
            selectedFiles.delete(li.dataset.path);
          } else {
            li.classList.add("selected");
            selectedFiles.add(li.dataset.path);
          }
        };

        li.onclick = () => {
          if (f.isDir) {
            const newPath = (path === "." ? f.name : path + "/" + f.name);
            ws.send(JSON.stringify({ 
              type:"list", 
              path:f.isUp ? path.split("/").slice(0,-1).join("/") || "." : newPath 
            }));
          } else {
            if (li.classList.contains("selected")) {
              li.classList.remove("selected");
              selectedFiles.delete(li.dataset.path);
            } else {
              li.classList.add("selected");
              selectedFiles.add(li.dataset.path);
            }
          }
        };

        li.appendChild(nameSpan);
        li.appendChild(selectBtn); // butonu ekle
        remoteList.appendChild(li);
      });
    }


    document.getElementById("deleteSelectedBtn").addEventListener("click", () => {
      if (selectedFiles.size === 0) return alert("HiÃ§ dosya seÃ§medin!");
      if (confirm(`${selectedFiles.size} dosyayÄ± silmek istediÄŸine emin misin?`)) {
        ws.send(JSON.stringify({
          type: "deleteMany",
          paths: Array.from(selectedFiles)
        }));
        selectedFiles.clear();
      }
    });

    document.getElementById("downloadSelectedBtn").addEventListener("click", () => {
      if (selectedFiles.size === 0) return alert("HiÃ§ dosya seÃ§medin!");
      Array.from(selectedFiles).forEach(path => {
        ws.send(JSON.stringify({ type:"download", path }));
      });
    });

    document.getElementById("localPicker").addEventListener("change", e => {
      renderLocal([...e.target.files]);
    });

    document.getElementById("uploadAllBtn").addEventListener("click", () => {
      [...localList.querySelectorAll("li")].forEach(li => {
        uploadFile(li.fileRef);
      });
    });


    function renderLocal(files) {
      localList.innerHTML = "";
      files.forEach(file => {
        const li = document.createElement("li");
        li.textContent = file.webkitRelativePath || file.name; // klasÃ¶r yapÄ±sÄ±nÄ± gÃ¶ster
        li.fileRef = file;

        const uploadBtn = document.createElement("button");
        uploadBtn.textContent = "YÃ¼kle";
        uploadBtn.onclick = () => uploadFile(file);

        li.appendChild(uploadBtn);
        localList.appendChild(li);
      });
    }


    function uploadFile(file) {
      const reader = new FileReader();
      reader.onload = () => {
        const arrayBuffer = reader.result;
        const bytes = new Uint8Array(arrayBuffer);
        let binary = '';
        for (let i = 0; i < bytes.byteLength; i++) {
          binary += String.fromCharCode(bytes[i]);
        }
        const relativePath = file.webkitRelativePath
          ? file.webkitRelativePath.replace(/[^/]+$/, '')
          : '';
        const targetPath = uploadPath === "." ? relativePath : uploadPath + "/" + relativePath;
        ws.send(JSON.stringify({
          type: "upload",
          path: targetPath,
          filename: file.name,
          content: btoa(binary)
        }));
      };
      reader.readAsArrayBuffer(file);
    }

    remoteSearch.addEventListener("input", () => {
      const term = remoteSearch.value.toLowerCase();
      const filtered = remoteFilesCache.filter(f => f.name.toLowerCase().includes(term));
      renderRemote(filtered, uploadPath);
    });
  </script>
</body>
</html>
